{% extends "_base.html" %}

{% block body_class %}detail joke-detail{% endblock body_class %}

{% block content %}

<div class="detail-header row-fluid">
    <div class="span10 offset1">
        <h2>{{ joke.primary_character }}</h2>
        <h1>{{ joke.text }}</h1>
        <p>{{ joke.blurb }}</p>
        <ul class="ad-key">
            <li class="key-j">Joke</li>
            <li class="key-b">Joke in the background</li>
            <li class="key-f">Foreshadowed joke</li>
            <li class="key-c">Related joke</li>
        </ul>
        <div id="joke-viz" class="viz" data-joke-code="{{ joke.code }}">
            <div id="viz-tooltip"></div>
        </div>
        <p class="detail-count"><span class="count">{{ episodejokes|length }}</span> episodes feature this joke:</p>
    </div>
</div>
{% for group in episodejokes|groupby('episode.season') %}
<div class="season row-fluid">
<h2 class="span3 offset1">Season {{ group.grouper }}</h2>
<ul class="episode-list span7">{% for ej in group.list %}
    <li>
        <a href="episode-{{ ej.episode.code }}.html">
            <span class="episode-number">{{ ej.episode.episode }}:</span> {{ ej.episode.title.strip() }}
        </a>
        {% if ej.details != None %}
            <p class="extra details">
                {{ ej.details.replace("/", "</span><span class='extra details'>")|safe }}
            </p>
        {% endif %}
        {% if ej.connections() != [] %}{% for joke in ej.connections() %}
            <h3>Related</h3>
            <p class="extra connection">
                <a href="{{ joke.url }}">{{ joke.text }}</a>
            </p>
        {% endfor %}{% endif %}
    </li>
{% endfor %}</ul>
</div>{% endfor %}

{% include "_source.html" %}

{% include "_comments.html" %}

<script type="text/javascript">
    var group_order = {{ group_order }};
    var joke_data = {{ joke_data }};
    var connection_data = {{ connection_data }};
    var episodes = {{ episodes }};
</script>

{% endblock %}

{% block extra_foot_js %}
{{ JS.push('js/lib/raphael.js') }}
{% endblock extra_foot_js %}
