{% extends "_base.html" %}

{% block body_class %}joke-detail{% endblock body_class %}

{% block content %}

<div class="detail-header">
    <h1><strong>{{ joke.primary_character }}</strong> {{ joke.text }}</h1>
    <p>{{ joke.blurb }}</p>
    <h2><span class="count">{{ episodejokes|length }}</span> episodes feature this joke:</h2>
</div>
{% for group in episodejokes|groupby('episode.season') %}
<div class="season row-fluid">
<h2 class="span2">Season {{ group.grouper }}</h2>
<ul class="episode-list span10">{% for ej in group.list %}
    <li>
        <a href="episode-{{ ej.episode.code }}.html">
            {{ ej.episode.episode }}: {{ ej.episode.title.strip() }}
        </a>
        {% if ej.details != None %}
            <p class="extra details">
                {{ ej.details.replace("/", "</span><span class='extra details'>")|safe }}
            </p>
        {% endif %}
        {% if ej.connections() != [] %}{% for joke in ej.connections() %}
            <h3>Related</h3>
            <p class="extra connection">
                <a href="{{ joke.url }}">
                    <strong>{{ joke.primary_character }}</strong>
                    {{ joke.text }}
                </a>
            </p>
        {% endfor %}{% endif %}
    </li>
{% endfor %}</ul>
</div>{% endfor %}

{% include "_comments.html" %}

{% endblock %}