{% extends "_base.html" %}

{% block body_class %}detail joke-detail{% endblock body_class %}

{% block content %}

<div class="detail-header">
    <h2>{{ joke.primary_character }}</h2>
    <h1>{{ joke.text }}</h1>
    <p>{{ joke.blurb }}</p>
    <p class="detail-count"><span class="count">{{ episodejokes|length }}</span> episodes feature this joke:</p>
</div>
{% for group in episodejokes|groupby('episode.season') %}
<div class="season row-fluid">
<h2 class="span2">Season {{ group.grouper }}</h2>
<ul class="episode-list span10">{% for ej in group.list %}
    <li>
        <a href="episode-{{ ej.episode.code }}.html">
            {{ ej.episode.episode }}: {{ ej.episode.title.strip() }}
        </a>
        {% if ej.details != None %}
            <p class="extra details">
                {{ ej.details.replace("/", "</span><span class='extra details'>")|safe }}
            </p>
        {% endif %}
        {% if ej.connections() != [] %}{% for joke in ej.connections() %}
            <h3>Related</h3>
            <p class="extra connection">
                <a href="{{ joke.url }}">{{ joke.text }}</a>
            </p>
        {% endfor %}{% endif %}
    </li>
{% endfor %}</ul>
</div>{% endfor %}
<p class="sources">Sources: Joke data compiled by Adam Cole / NPR. Episode metadata from <a href="http://thetvdb.com/">The TVDB</a> via a <a href="http://creativecommons.org/licenses/by/3.0/us/">Creative Commons Attribution 3.0 United States (CC BY 3.0 US)</a> license.</p>
{% endblock %}